<!DOCTYPE html>
<html lang="en" style="height: 100%">
<head>
    <meta charset="UTF-8">
    <title>管理员平台</title>
    <link rel="stylesheet" type="text/css" href="styles/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="styles/index.css">
    <link rel="stylesheet" type="text/css" href="styles/vuescroll.css">
</head>
<body style="height: 100%">
<div id="manage" style="height: 100%">
    <el-container style="width: 100%;background-color: white;height: 100%">
        <el-header style="background-color: #5bb2ff">
            <h5 style="text-align: center;color: white;height: 30px;line-height: 50px;float: left;">管理系统</h5>
        </el-header>
        <el-container style="height: 100%">
            <el-aside style="width: 15%;height: 100%">
                <el-menu
                        style="height: 100%"
                        :default-active="activeIndex"
                        class="el-menu-vertical-demo"
                        @select="handleSelect"
                        background-color="#606266"
                        text-color="#fff"
                        active-text-color="#5bb2ff">
                    <el-menu-item-group>
                        <el-menu-item index="1">商品类型</el-menu-item>
                        <el-menu-item index="2">商品管理</el-menu-item>
                        <el-menu-item index="3">选项3</el-menu-item>
                        <el-menu-item index="4">选项4</el-menu-item>
                    </el-menu-item-group>
                </el-menu>
            </el-aside>
            <el-main style="height: 100%">
                <!---------------商品类型管理--------------->
                <el-row v-if="this.activeIndex=='1'" style="height: 100%">
                    <el-col :span="7">
                        <el-card shadow="always">
                            <div slot="header">
                                <span>{{title}}</span>
                            </div>
                            <el-row>
                                <el-col :span="24">
                                    <el-button type="primary" style="width:100%;" @click="btnCk($event)" v-if="this.formStyle=='display:none;'">创建新标签</el-button>
                                </el-col>
                            </el-row>

                            <el-form ref="form" :model="form" label-width="80px" :style="formStyle" size="small">
                                <el-form-item label="上级类型" prop="pName">
                                    <el-cascader expand-trigger="hover" :options="options"  placeholder="请选择" :clearable="true" v-model="form.pName"
                                                 :change-on-select="true" :show-all-levels="false" @change="handleChange">
                                    </el-cascader>
                                </el-form-item>
                                <el-form-item label="类型名称" prop="name">
                                    <el-input v-model="form.name"></el-input>
                                </el-form-item>
                                <el-form-item label="类型值" prop="value">
                                    <el-input v-model="form.value"></el-input>
                                </el-form-item>
                                <el-form-item label="类型描述" prop="summary">
                                    <el-input v-model="form.summary"></el-input>
                                </el-form-item>
                                <el-row class="mt">
                                    <el-col :span="24" style="text-align: right;">
                                        <el-button type="primary" @click="saveParameter" v-if="this.title=='新建类型'">保存</el-button>
                                        <el-button type="primary" @click="modifyParameter" v-if="this.title=='修改类型'">修改</el-button>
                                        <el-button @click="resetForm('form')">重置</el-button>
                                    </el-col>
                                </el-row>
                            </el-form>
                        </el-card>
                    </el-col>
                    <el-col :span="17">
                        <el-card shadow="always">
                            <div slot="header">
                                <span>商品类型列表</span>
                            </div>
                            <el-row >
                                <el-col :span="24" >
                                    <el-table :data="tableData" border height="450" size="mini">
                                        <el-table-column prop="name" label="类型名称" >
                                        </el-table-column>
                                        <el-table-column prop="parentName" label="上级类型" >
                                        </el-table-column>
                                        <el-table-column prop="value" label="类型值" >
                                        </el-table-column>
                                        <el-table-column prop="level" label="类型等级" >
                                        </el-table-column>
                                        <el-table-column prop="summary" label="类型描述" >
                                        </el-table-column>
                                        <el-table-column fixed="right" label="操作" width="100">
                                            <template slot-scope="scope">
                                                <el-button type="text" size="small" @click="openModify(scope.row)">修改</el-button>
                                            </template>
                                        </el-table-column>
                                    </el-table>
                                    <el-pagination
                                            :page-sizes="[8, 16, 32, 64]"
                                            :current-page="current"
                                            :page-size ="size"
                                            @size-change="handleSizeChange"
                                            @current-change="handleCurrentChange"
                                            layout="total, sizes, prev, pager, next, jumper"
                                            :total="total">
                                    </el-pagination>
                                </el-col>
                            </el-row>
                        </el-card>
                    </el-col>
                </el-row>
                <!---------------商品类型管理--------------->
                <el-row v-if="this.activeIndex=='2'">
                    <el-col :span="7">
                        <el-card shadow="always">
                            <div slot="header">
                                <span>{{goodsTitle}}</span>
                            </div>
                            <el-row>
                                <el-col :span="24">
                                    <el-button type="primary" style="width:100%;" @click="goodsBtnCk($event)" v-if="this.goodsFormStyle=='display:none;'">创建新商品</el-button>
                                </el-col>
                            </el-row>

                            <el-form ref="goodsForm" :model="goodsForm" label-width="80px" :style="goodsFormStyle" size="small">
                                <el-form-item label="商品类型" prop="pName">
                                    <el-cascader expand-trigger="hover" :options="options"  placeholder="请选择" :clearable="true" v-model="goodsForm.pName"
                                                 :change-on-select="true" :show-all-levels="false" @change="goodsHandleChange">
                                    </el-cascader>
                                </el-form-item>
                                <el-form-item label="商品品牌" prop="brandName">
                                    <el-input v-model="goodsForm.brandName"></el-input>
                                </el-form-item>
                                <el-form-item label="商品名称" prop="name">
                                    <el-input v-model="goodsForm.name"></el-input>
                                </el-form-item>
                                <el-form-item label="商品型号" prop="marque">
                                    <el-input v-model="goodsForm.marque"></el-input>
                                </el-form-item>
                                <el-form-item label="参考价格" prop="price">
                                    <el-input v-model="goodsForm.price"></el-input>
                                </el-form-item>
                                <el-row class="mt">
                                    <el-col :span="24" style="text-align: right;">
                                        <el-button type="primary" @click="saveGoods" v-if="this.goodsTitle=='新建商品'">保存</el-button>
                                        <el-button type="primary" @click="modifyGoods" v-if="this.goodsTitle=='修改商品'">修改</el-button>
                                        <el-button @click="resetForm('goodsForm')">重置</el-button>
                                    </el-col>
                                </el-row>
                            </el-form>
                        </el-card>
                    </el-col>
                    <el-col :span="17">
                        <el-card shadow="always">
                            <div slot="header">

                                <span>商品列表</span>
                                <div style="float: right;">
                                    <el-cascader expand-trigger="hover" :options="options"  placeholder="请选择类型" :clearable="true"
                                                 :change-on-select="true" :show-all-levels="false" @change="goodsSearchHandleChange">
                                    </el-cascader>
                                    <el-input v-model="goodsSearchName" placeholder="请输入商品名" style="width: 180px"></el-input>
                                    <el-button type="primary" @click="searchGoods">搜索</el-button>
                                </div>
                            </div>
                            <el-row>
                                <el-col :span="24">
                                    <el-table :data="goodsTableData" border height="450" size="mini">
                                        <el-table-column prop="name" label="商品名称" >
                                        </el-table-column>
                                        <el-table-column prop="typeName" label="类型" >
                                        </el-table-column>
                                        <el-table-column prop="brandName" label="品牌名" >
                                        </el-table-column>
                                        <el-table-column prop="marque" label="型号" >
                                        </el-table-column>
                                        <el-table-column prop="price" label="参考价" >
                                        </el-table-column>
                                        <el-table-column prop="status" label="状态" >
                                            <template slot-scope="scope">
                                                <el-tag type="danger" v-if="scope.row.status=='disabled'">冻结</el-tag>
                                                <el-tag v-if="scope.row.status=='enabled'">正常</el-tag>
                                                <el-tag type="success" v-if="scope.row.status=='unaudited'">待审核</el-tag>
                                            </template>
                                        </el-table-column>
                                        <el-table-column fixed="right" label="操作" width="100">
                                            <template slot-scope="scope">
                                                <el-button type="text" size="small" @click="openGoodsModify(scope.row)">修改</el-button>
                                                <el-button type="text" size="small" v-if="scope.row.status=='unaudited'" @click="modifyGoodsStatus(scope.row.id,'enabled')">发布</el-button>
                                                <el-button type="text" size="small" v-if="scope.row.status=='enabled'" @click="modifyGoodsStatus(scope.row.id,'disabled')">冻结</el-button>
                                                <el-button type="text" size="small" v-if="scope.row.status=='disabled'" @click="modifyGoodsStatus(scope.row.id,'enabled')">解冻</el-button>
                                            </template>
                                        </el-table-column>
                                    </el-table>
                                    <el-pagination
                                            :page-sizes="[8, 16, 32, 64]"
                                            :current-page="goodsCurrent"
                                            :page-size ="goodsSize"
                                            @size-change="goodsHandleSizeChange"
                                            @current-change="goodsHandleCurrentChange"
                                            layout="total, sizes, prev, pager, next, jumper"
                                            :total="goodsTotal">
                                    </el-pagination>
                                </el-col>
                            </el-row>
                        </el-card>
                    </el-col>
                </el-row>
            </el-main>
        </el-container>
    </el-container>
</div>

</body>
<script src="js/vue.js"></script>
<script src="js/index.js"></script>
<script src="js/axios.min.js"></script>
<script src="js/vuescroll-native.js"></script>
<script src="js/vuescroll-slide.js"></script>
<script src="js/vuescroll.js"></script>
<script src="js/jquery-3.2.1.min.js"></script>
<script type="text/javascript">
    new Vue({
        el:"#manage",
        data:function(){
            return {
                activeIndex:null,
                //商品类型所用参数
                tableData: [],
                title:"新建类型",
                total:0,
                current:1,
                size:8,
                options: [],
                form: {
                    id:null,
                    pId:null,
                    name: null,
                    parentName:null,
                    value:null,
                    summary:null,
                    pName:[],
                    level:null,

                },
                formStyle:"display:none;",
                labelStyle:"color:#2c8cf0;display:block;",
                inputStyle:"display:none",
                divStyle:"display:none",
                //商品所用参数
                goodsSearchName:null,
                searchTypeId:null,
                goodsTableData:[],
                goodsCurrent:1,
                goodsSize:8,
                goodsTotal:0,
                goodsForm: {
                    id:null,
                    typeId:null,
                    name: null,
                    pName:[],
                    price:null,
                    brandName:null,
                    marque:null,
                },
                goodsFormStyle:"display:none;",
                goodsTitle:"新建商品",
            }
        },
        methods:{
            getParentGoodsType:function(){
                const _this=this;
                axios.get('http://'+window.location.host+'/goodsType/getParentGoodsType')
                    .then(function (response) {
                        if(response.data.rtnFlag=="9999"){//请求成功
                            _this.options=response.data.rtnData;
                        }else if(response.data.rtnFlag=="1001"){//未登录
                            //_this.loginDgVisible=true;
                        }else{
                            _this.$bdmsg({
                                type:"toast",
                                msgType:"error",
                                message: "获取上级类型数据"+'失败！'+response.data.rtnMsg
                            });
                        }
                    }).catch(function (error) {
                    // handle error
                    console.log(error);
                }).then(function () {
                    // always executed
                });
            },
            //左侧栏目功能
            handleSelect(key) {
                this.activeIndex=key;
                if(this.activeIndex=="1")   this.initTable();
                if(this.activeIndex=="2")   this.initGoodsTable();
            },
            //商品类型
            initTable:function(){
                const _this=this;
                _this.loading=true;
                axios.post('http://'+window.location.host+'/goodsType/getGoodsType',{size:_this.size,current:_this.current})
                    .then(function (response) {
                        if(response.data.rtnFlag=="9999"){//请求成功
                            _this.tableData=response.data.rtnData;
                            _this.total=response.data.total;
                        }else if(response.data.rtnFlag=="1001"){//未登录
                            //_this.loginDgVisible=true;
                        }else{
                            _this.$bdmsg({
                                type:"toast",
                                msgType:"error",
                                message: "初始化类型数据"+'失败！'+response.data.rtnMsg
                            });
                        }
                    }).catch(function (error) {
                    // handle error
                    console.log(error);
                }).then(function () {
                    // always executed
                });
            },
            saveParameter:function(){
                const _this=this;
                axios.post('http://'+window.location.host+'/goodsType/addGoodsType',_this.form)
                    .then(function (response) {
                        if(response.data.rtnFlag=="9999"){//请求成功
                            _this.form.id=response.data.rtnData.id;
                            _this.initTable();
                            _this.title="修改类型";
                            _this.$message('新建类型数据成功！');
                        }else if(response.data.rtnFlag=="1001"){//未登录
                            //_this.loginDgVisible=true;
                        }else{
                            _this.$bdmsg({
                                type:"toast",
                                msgType:"error",
                                message: "新建类型数据"+'失败！'+response.data.rtnMsg
                            });
                        }
                    }).catch(function (error) {
                    // handle error
                    console.log(error);
                }).then(function () {
                    // always executed
                });
            },
            modifyParameter:function(){
                const _this=this;
                axios.post('http://'+window.location.host+'/goodsType/modifyGoodsType',_this.form)
                    .then(function (response) {
                        if(response.data.rtnFlag=="9999"){//请求成功
                            _this.initTable();
                            _this.$message('修改类型数据成功！');
                        }else if(response.data.rtnFlag=="1001"){//未登录
                            //_this.loginDgVisible=true;
                        }else{
                            _this.$bdmsg({
                                type:"toast",
                                msgType:"error",
                                message: "修改类型数据"+'失败！'+response.data.rtnMsg
                            });
                        }
                    }).catch(function (error) {
                    // handle error
                    console.log(error);
                }).then(function () {
                    // always executed
                });
            },
            resetForm:function(formName){
                const _this=this;
                _this.$refs[formName].resetFields();
                if(formName=="form") _this.title="新建类型";
                else if(formName=="goodsForm") _this.goodsTitle="新建商品";
            },
            openModify:function(goodsType){
                const _this=this;
                _this.form=JSON.parse(JSON.stringify(goodsType));
                _this.formStyle="display:block;"
                _this.title="修改类型";
            },
            //级联选择器
            handleChange:function(value){
                this.pId=value[value.length-1];
            },
            handleSizeChange:function(val) {
                this.size=val;
                this.initTable();
            },
            handleCurrentChange:function(val) {
                this.current=val;
                this.initTable();
            },
            btnCk:function(event){
                this.formStyle="display:block;"
            },

            //商品

            goodsSearchHandleChange:function(value){
                this.searchTypeId=value[value.length-1];
            },

            initGoodsTable:function(){
                const _this=this;
                _this.loading=true;
                axios.post('http://'+window.location.host+'/goods/getGoodsPage',{size:_this.goodsSize,
                    current:_this.goodsCurrent,typeId:_this.searchTypeId,name:_this.goodsSearchName,status:"all"})
                    .then(function (response) {
                        if(response.data.rtnFlag=="9999"){//请求成功
                            _this.goodsTableData=response.data.rtnData;
                            _this.goodsTotal=response.data.total;
                        }else if(response.data.rtnFlag=="1001"){//未登录
                            //_this.loginDgVisible=true;
                        }else{
                            _this.$bdmsg({
                                type:"toast",
                                msgType:"error",
                                message: "初始化商品数据"+'失败！'+response.data.rtnMsg
                            });
                        }
                    }).catch(function (error) {
                    // handle error
                    console.log(error);
                }).then(function () {
                    // always executed
                });
            },
            searchGoods:function(){
                this.initGoodsTable();
            },
            saveGoods:function(){
                const _this=this;
                axios.post('http://'+window.location.host+'/goods/addGoods',{form:_this.goodsForm,status:"enabled"})
                    .then(function (response) {
                        if(response.data.rtnFlag=="9999"){//请求成功
                            _this.goodsForm.id=response.data.rtnData.id;
                            _this.initGoodsTable();
                            _this.title="修改商品";
                            _this.$message('新建商品数据成功！');
                        }else if(response.data.rtnFlag=="1001"){//未登录
                            //_this.loginDgVisible=true;
                        }else{
                            _this.$bdmsg({
                                type:"toast",
                                msgType:"error",
                                message: "新建商品数据"+'失败！'+response.data.rtnMsg
                            });
                        }
                    }).catch(function (error) {
                    // handle error
                    console.log(error);
                }).then(function () {
                    // always executed
                });
            },
            modifyGoods:function(){
                const _this=this;
                axios.post('http://'+window.location.host+'/goods/modifyGoods',_this.goodsForm)
                    .then(function (response) {
                        if(response.data.rtnFlag=="9999"){//请求成功
                            _this.initGoodsTable();
                            _this.$message('修改商品数据成功！');
                        }else if(response.data.rtnFlag=="1001"){//未登录
                            //_this.loginDgVisible=true;
                        }else{
                            _this.$bdmsg({
                                type:"toast",
                                msgType:"error",
                                message: "修改商品数据"+'失败！'+response.data.rtnMsg
                            });
                        }
                    }).catch(function (error) {
                    // handle error
                    console.log(error);
                }).then(function () {
                    // always executed
                });
            },
            modifyGoodsStatus:function(id,status){
                const _this=this;
                axios.post('http://'+window.location.host+'/goods/modifyGoodsStatus',{id:id,status:status})
                    .then(function (response) {
                        if(response.data.rtnFlag=="9999"){//请求成功
                            _this.initGoodsTable();
                            _this.$message('修改商品状态成功！');
                        }else if(response.data.rtnFlag=="1001"){//未登录
                            //_this.loginDgVisible=true;
                        }else{
                            _this.$bdmsg({
                                type:"toast",
                                msgType:"error",
                                message: "修改商品状态"+'失败！'+response.data.rtnMsg
                            });
                        }
                    }).catch(function (error) {
                    // handle error
                    console.log(error);
                }).then(function () {
                    // always executed
                });
            },
            openGoodsModify:function(goods){
                const _this=this;
                _this.goodsForm=JSON.parse(JSON.stringify(goods));
                _this.goodsFormStyle="display:block;"
                _this.goodsTitle="修改商品";
            },
            goodsBtnCk:function(event){
                this.goodsFormStyle="display:block;"
            },
            goodsHandleChange:function(value){
                this.goodsForm.typeId=value[value.length-1];
            },
            goodsHandleSizeChange:function (val) {
                this.goodsSize=val;
                this.initGoodsTable();
            },
            goodsHandleCurrentChange:function(val){
                this.goodsCurrent=val;
                this.initGoodsTable();
            },

        },
        mounted: function() {
            const _this = this;
            _this.getParentGoodsType();
        },
    });
</script>
</html>